<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Crear Venta</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <h:form id="ventaForm">
            <p:growl id="messages" showDetail="true" />

            <!-- Seleccionar Cliente -->
            <p:outputLabel for="cliente" value="Cliente:" />
            <p:selectOneMenu value="#{beanIndex.clienteSeleccionado}" converter="clienteConverter">
                <f:selectItems value="#{beanIndex.listaClientes}" var="cliente" 
                               itemLabel="#{cliente.nombre}" itemValue="#{cliente}" />
            </p:selectOneMenu>


            <p:dataTable id="productosTable" var="producto" value="#{beanIndex.listaProductos}" 
                         selection="#{beanIndex.productosSeleccionados}" rowKey="#{producto.idProducto}">
                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                <p:column headerText="ID">
                    <h:outputText value="#{producto.idProducto}" />
                </p:column>
                <p:column headerText="Nombre">
                    <h:outputText value="#{producto.nombre}" />
                </p:column>
                <p:column headerText="Precio">
                    <h:outputText value="#{producto.precio}" />
                </p:column>
            </p:dataTable>

            <!-- BotÃ³n para agregar productos seleccionados al detalle de la venta -->
            <p:commandButton value="Agregar Productos" action="#{beanIndex.agregarProductosADetalle}" update="detallesVentaTable" />

            <!-- Detalles de la Venta -->
            <p:dataTable id="detallesVentaTable" var="detalle" value="#{beanIndex.detallesVenta}">
                <p:column headerText="Producto">
                    <h:outputText value="#{detalle.producto.nombre}" />
                </p:column>
                <p:column headerText="Cantidad">
                    <p:inputText value="#{detalle.cantidad}" />
                </p:column>
                <p:column headerText="Precio">
                    <h:outputText value="#{detalle.producto.precio}" />
                </p:column>
                <p:column headerText="Subtotal">
                    <h:outputText value="#{detalle.subtotal}" />
                </p:column>
                <p:column>
                    <p:commandButton icon="ui-icon-trash" action="#{beanIndex.removerDetalle(detalle)}" update="detallesVentaTable" />
                </p:column>
            </p:dataTable>

            <!-- BotÃ³n para guardar la venta completa -->
            <p:commandButton value="Guardar Venta" action="#{beanIndex.guardarVenta}" update="messages" ajax="false" />
        </h:form>
    </h:body>
</html>
